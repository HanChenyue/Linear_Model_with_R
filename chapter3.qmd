---
title: "Linear_Model_with_R"
author: Han Chenyue
editor: source
format: pdf
---

# Chapter 3

## Exercises

### Q1

#### q1a

```{r}
data(prostate, package = "faraway")
lm_q1a <- lm(lpsa ~ .,
            data = prostate) 
summary(lm_q1a)
```

```{r}
cat("90% CI for age: ", round(summary(lm1)$coef[4, 1] + c(-1, 1) * qt(0.95, 97 - 9) * summary(lm1)$coef[4, 2], 4))
cat("\n")
cat("95% CI for age: ", round(summary(lm1)$coef[4, 1] + c(-1, 1) * qt(0.975, 97 - 9) * summary(lm1)$coef[4, 2], 4))
```

Visualising it:

```{r}
library(ggplot2)
library(broom)
library(dplyr)

ci_90 <- tidy(lm1, conf.int = TRUE, conf.level = 0.90) |> 
    filter(term == "age") |> 
    mutate(level = "90% CI (p-value <= 0.10, alpha = 0.10)")

ci_95 <- tidy(lm1, conf.int = TRUE, conf.level = 0.95) |> 
    filter(term == "age") |> 
    mutate(level = "95% CI (p-value <= 0.05, alpha = 0.05)")

ci_combined <- bind_rows(ci_90, ci_95)

ggplot(ci_combined, aes(x = estimate, y = level, colour = level)) +
    geom_errorbarh(aes(xmin = conf.low, xmax = conf.high),
                    height = 0.1, linewidth = 1.5) +
    geom_point(size = 5, shape = 19) +
    geom_vline(xintercept = 0, linetype = "dashed", colour = "black", linewidth = 1) +
    labs(
        title = "Bracketing the p-value for the 'age' Coefficient",
        x = "Coefficient Value",
    ) +
    scale_color_manual(values = c("red", "blue")) +
    theme(legend.position = "none")
```

90% CI for age does not include 0 but 95% CI for age does, therefore the p-value lies within 0.05 and 0.10.

#### q1b

```{r}
library(ellipse)
plot(ellipse(lm_q1a, c(4, 5)), type = "l")
points(coef(lm_q1a)[4], coef(lm_q1a)[5])
abline(v = confint(lm_q1a)[4, c(1, 2)], lty = 4)
abline(h = confint(lm_q1a)[5, c(1, 2)], lty = 4)
abline(v = 0, lty = 2, col = "blue")
abline(h = 0, lty = 2, col = "blue")
points(0, 0, pch = 21)
```

-   Origin ($\beta_age = 0$, $\beta_lbph = 0$) falls within both the $95\%$ joint confidence ellipse and the rectangular region defined by the individual $95\%$ univariate confidence intervals.
-   Neither predictor is statistically significant when considered in isolation within the full model.
-   Crucially, because the origin lies inside the joint confidence ellipse, we do not reject the null hypothesis that both coefficients are simultaneously zero. This is consistent with the result of the formal F-test for nested models:

```{r}
lm_q1b <- lm(lpsa ~ lcavol + lweight + svi + lcp + gleason + pgg45, data = prostate)
anova(lm_q1b, lm_q1a)
```

-   The non-significant p-value from this F-test confirms the visual evidence from the ellipse: we fail to find sufficient statistical evidence to reject the null hypothesis.

#### q1c

```{r}
lm_q1c <- lm(lpsa ~ lcavol + lweight + svi, data = prostate)
summary(lm_q1c)
anova(lm_q1c, lm_q1a)
```

Since `p-value` is much larger than $\alpha = 0.05$, we fail to reject the null hypothesis, $H_0: \beta_{age} = \beta_{lbph} = \beta_{lcp} = \beta_{gleason} = \beta_{pgg45} = 0$.

We conclude that the five predictors removed from the full model **do not collectively contribute statistically significant explanatory power** to the model.

